---
name: doc-management
description: 在完成代码变更、功能开发、API修改、架构调整、bug修复、性能优化等任务后，自动识别并更新相关项目文档（README、CHANGELOG、API_DOC、ARCHITECTURE、DEPLOYMENT等），确保文档与代码保持同步。当任务涉及代码或功能变动时主动使用此skill。
---

# Documentation Management

当代码、功能或架构发生变更时，自动识别并更新相关文档，确保文档与代码保持同步。

## 文档路径与存储位置

所有开发文档存放于 `.cursor/docs/` 目录下。如果文档不存在，需要主动创建。

### 标准文档目录结构
```
.cursor/docs/
├── README.md           # 项目总览
├── CHANGELOG.md        # 变更日志
├── API_DOC.md          # API接口文档
├── ARCHITECTURE.md     # 架构文档
└── DEPLOYMENT.md       # 部署文档

src/
└── <module>/
    └── README.md       # 模块文档
```

## 核心文档清单

### 1. README.md (项目总览)

**文档路径**: `.cursor/docs/README.md`

**用途**:
- 项目的核心介绍
- 主要功能模块
- 架构概述
- 安装部署指南
- 使用方法

**更新时机**:
- ✅ 项目架构变化
- ✅ 功能模块变更
- ✅ 安装配置变动
- ✅ 依赖库更新
- ✅ 使用方法调整

**内容结构**:
```markdown
# 项目名称

## 项目简介
[项目的核心价值和目标]

## 主要功能
- 功能1: 描述
- 功能2: 描述

## 技术架构
[架构概述和技术栈]

## 快速开始
### 环境要求
### 安装步骤
### 运行项目

## 使用指南
[基本使用方法]

## 项目结构
[目录结构说明]
```

### 2. CHANGELOG.md (变更日志)

**文档路径**: `.cursor/docs/CHANGELOG.md`

**用途**: 记录项目的所有重要变更

**更新时机**:
- ✅ 每次完成导致代码或功能变动的任务后
- ✅ 发布新版本前

**更新格式**:
```markdown
## [版本号或日期 YYYY-MM-DD]

### 新增 ✨
- [模块/功能]: 描述新增的具体功能或特性
  *影响范围：描述此新增对哪些部分产生了影响。*

### 修复 🐛
- [模块/问题]: 描述修复的具体问题。
  *原因：简述问题产生的原因（可选）。*

### 优化 🚀
- [模块/方面]: 描述进行的优化及其带来的改进。

### 变更 ⚠️
- [模块/功能]: 描述发生的变更，特别是破坏性变更或重要调整。
```

**示例**:
```markdown
## [2026-01-05]

### 新增 ✨
- [用户模块]: 添加用户头像上传功能
  *影响范围：用户个人资料页面、API接口 /api/users/avatar*

### 修复 🐛
- [认证模块]: 修复 token 过期后未正确刷新的问题
  *原因：中间件未正确处理 401 响应*

### 优化 🚀
- [数据库]: 优化用户查询性能，添加索引
  *性能提升：查询速度提升 60%*

### 变更 ⚠️
- [API]: 用户注册接口参数格式变更
  *破坏性变更：需要更新客户端代码*
```

### 3. API_DOC.md (API接口文档)

**文档路径**: `.cursor/docs/API_DOC.md`

**用途**: 详细描述项目提供的所有API接口

**更新时机**:
- ✅ 新增API接口
- ✅ 修改现有API接口（参数、路径、请求/响应结构、认证方式变更）
- ✅ 废弃或移除API接口

**更新要点**: 确保API文档的准确性和完整性，包含清晰的请求和响应示例

**内容结构**:
```markdown
# API 接口文档

## 认证方式
[描述认证机制，如 JWT、OAuth 等]

## 接口列表

### 用户管理

#### 创建用户
- **URL**: `/api/users`
- **方法**: `POST`
- **认证**: 需要管理员权限
- **请求类型**: `application/json`

**参数说明**:
| 参数 | 类型 | 必填 | 默认值 | 说明 |
|------|------|------|--------|------|
| `username` | string | ✅ | - | 用户名，3-20个字符 |
| `email` | string | ✅ | - | 邮箱地址 |
| `password` | string | ✅ | - | 密码，最少8位 |
| `role` | string | ❌ | `"user"` | 用户角色：`user`/`admin` |

**请求示例**:
```json
{
  "username": "testuser",
  "email": "test@example.com",
  "password": "password123",
  "role": "user"
}
```

**响应示例** (200):
```json
{
  "id": 1,
  "username": "testuser",
  "email": "test@example.com",
  "role": "user",
  "created_at": "2026-01-05T10:00:00Z"
}
```

**错误响应**:
- `400`: 参数验证失败
- `401`: 未授权
- `409`: 用户已存在
```

### 4. ARCHITECTURE.md (架构文档)

**文档路径**: `.cursor/docs/ARCHITECTURE.md`

**用途**: 描述项目的整体架构、模块划分、技术选型、数据流等

**更新时机**:
- ✅ 架构调整
- ✅ 模块重组
- ✅ 技术栈变更
- ✅ 新增核心模块

**更新要点**: 包含架构图、模块关系图、数据流图等可视化内容

**内容结构**:
```markdown
# 架构文档

## 整体架构
[系统架构概述，可包含架构图]

## 技术栈
- **后端**: Python 3.11, FastAPI
- **数据库**: PostgreSQL
- **缓存**: Redis
- **消息队列**: RabbitMQ

## 模块划分
### API 层
[描述 API 层的职责和设计]

### 业务逻辑层
[描述服务层的职责和设计]

### 数据访问层
[描述数据层的职责和设计]

## 数据流
[描述数据在系统中的流转过程]

## 设计决策
[记录重要的架构决策和原因]
```

### 5. DEPLOYMENT.md (部署文档)

**文档路径**: `.cursor/docs/DEPLOYMENT.md`

**用途**: 详细描述项目的部署步骤、环境要求、配置说明等

**更新时机**:
- ✅ 部署流程变更
- ✅ 环境要求调整
- ✅ 配置项变动
- ✅ 新增部署方式

**更新要点**: 提供完整的部署步骤、环境检查清单、常见问题解决方案

**内容结构**:
```markdown
# 部署文档

## 环境要求
- Python 3.11+
- PostgreSQL 14+
- Redis 6+

## 部署步骤
### 1. 环境准备
### 2. 依赖安装
### 3. 配置文件
### 4. 数据库初始化
### 5. 启动服务

## 配置说明
[详细的配置项说明]

## 常见问题
[部署过程中的常见问题和解决方案]
```

### 6. 模块文档 (Module README)

**文档路径**: `src/<module>/README.md`

**用途**: 描述每个功能模块的详细设计、实现细节、使用方法等

**更新时机**:
- ✅ 模块设计变更
- ✅ 实现细节更新
- ✅ 使用方法调整
- ✅ 新增模块功能

**更新要点**: 包含模块功能描述、类图、时序图等可视化内容

**内容结构**:
```markdown
# [模块名称] 模块

## 模块概述
[模块的核心功能和职责]

## 主要组件
### 类/函数列表
- `ClassName`: 描述
- `function_name()`: 描述

## 使用示例
[代码示例]

## 依赖关系
[模块依赖的其他模块]

## 设计说明
[设计思路和实现细节]
```

## 文档更新执行流程

### 自动化更新流程

当完成代码变更后，按照以下流程更新文档：

**步骤 1: 分析变更**
- 理解操作对代码、功能、API等方面带来的具体变化
- 识别变更的影响范围和类型

**步骤 2: 对照规则**
- 根据变更类型判断哪些文档需要更新
- 确定更新的优先级

**步骤 3: 执行更新**
- 按照每个文档的格式和要求，进行内容的添加或修改
- 保持文档风格的一致性

**步骤 4: 确保一致性**
- 检查文档间的引用和交叉链接是否正确
- 验证文档内容与代码实际情况一致

### 变更类型与文档映射

| 变更类型 | 需要更新的文档 |
|---------|--------------|
| 新增功能模块 | README.md, CHANGELOG.md, ARCHITECTURE.md |
| 修改现有功能 | CHANGELOG.md, 相关模块 README.md |
| 新增/修改 API | API_DOC.md, CHANGELOG.md |
| 架构调整 | ARCHITECTURE.md, README.md, CHANGELOG.md |
| 部署流程变更 | DEPLOYMENT.md, CHANGELOG.md |
| 依赖库更新 | README.md, DEPLOYMENT.md, CHANGELOG.md |
| Bug 修复 | CHANGELOG.md |
| 性能优化 | CHANGELOG.md, ARCHITECTURE.md (如涉及架构) |

## 文档更新最佳实践

### 1. 及时性原则
- 在完成代码变更的同时更新文档
- 不要积累文档债务
- 将文档更新作为任务完成的一部分

### 2. 准确性原则
- 确保文档内容与代码实际情况一致
- 包含准确的代码示例和配置
- 及时删除过时的信息

### 3. 完整性原则
- 提供足够的上下文信息
- 包含必要的示例和说明
- 覆盖常见使用场景

### 4. 可读性原则
- 使用清晰的标题和结构
- 采用一致的格式和风格
- 提供目录和导航链接

### 5. 版本控制原则
- 在 CHANGELOG 中记录所有重要变更
- 使用语义化版本号
- 保留历史变更记录

## 文档检查清单

在完成文档更新后，使用以下检查清单验证：

- [ ] 文档内容与代码实际情况一致
- [ ] 所有链接和引用正确有效
- [ ] 代码示例可以正常运行
- [ ] 格式和风格保持一致
- [ ] 没有拼写和语法错误
- [ ] CHANGELOG 已更新
- [ ] 相关文档间的交叉引用已更新

## 常见文档更新场景

### 场景 1: 新增 API 接口
**需要更新的文档**:
1. `API_DOC.md`: 添加新接口的完整文档
2. `CHANGELOG.md`: 在"新增"部分记录

**示例**:
```markdown
# API_DOC.md
#### 获取用户列表
- **URL**: `/api/users`
- **方法**: `GET`
- **认证**: 需要管理员权限

**查询参数**:
| 参数 | 类型 | 必填 | 默认值 | 说明 |
|------|------|------|--------|------|
| `page` | integer | ❌ | `1` | 页码，从1开始 |
| `limit` | integer | ❌ | `20` | 每页数量，范围1-100 |
| `role` | string | ❌ | - | 角色过滤：`user`/`admin` |

**响应示例** (200):
```json
{
  "total": 100,
  "page": 1,
  "limit": 20,
  "users": [...]
}
```

# CHANGELOG.md
### 新增 ✨
- [用户模块]: 添加获取用户列表接口 GET /api/users
  *影响范围：新增接口，支持分页和角色过滤*
```

### 场景 2: 架构调整
**需要更新的文档**:
1. `ARCHITECTURE.md`: 更新架构图和说明
2. `README.md`: 更新技术栈或架构概述
3. `CHANGELOG.md`: 在"变更"部分记录

### 场景 3: Bug 修复
**需要更新的文档**:
1. `CHANGELOG.md`: 在"修复"部分记录

### 场景 4: 新增功能模块
**需要更新的文档**:
1. `README.md`: 更新功能列表和项目结构
2. `ARCHITECTURE.md`: 更新模块划分
3. `CHANGELOG.md`: 在"新增"部分记录
4. `src/<module>/README.md`: 创建模块文档

## 注意事项

### 文档创建
- 如果文档不存在，主动创建
- 使用标准的文档模板
- 确保目录结构正确

### 文档维护
- 定期审查文档的准确性
- 删除过时的内容
- 保持文档的简洁性

### 协作规范
- 文档变更应与代码变更同步提交
- 重大文档变更需要团队评审
- 保持文档风格的一致性
