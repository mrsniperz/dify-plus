# 智能排程功能 - 业务需求文档

## 1. 项目背景与目标

根据公司对“维修规划及资源智能化”的总体要求，本项目旨在通过AI技术智能化生成和调整发动机QEC（Quick Engine Change）维修计划，核心是优化航材、人员、工具、场地等关键资源的配置效率。

**最终目标**：建立一个能够响应实时变化、满足复杂业务约束、并以“总工时最短、成本最低、资源利用率最高”为导向的智能调度引擎。

## 2. 核心业务概念

### 2.1 调度单元：工卡子项目 (Job)

- **定义**: 排程系统中最基础的原子任务，对应工卡中一个具体的操作步骤（如 `AMM TASK 71-51-43-400-001-A`）。
- **关键信息**: 每个子项目都明确关联了其所需的**基准工时**、**资源清单**（人力、航材、工具）和**前置依赖关系**。

### 2.2 核心资源 (Resource)

- **人力资源**: 
  - **属性**: 员工、资质、排班、历史绩效（在特定任务上的熟练度）。
  - **业务要求**: 系统需根据任务的资质要求，在可用班次内，优先选择历史绩效更好的员工。
- **物理资源**:
  - **分类**: 工具、航材、大型设备（如行车）、工位。
  - **业务要求**: 系统需实时跟踪各类资源的可用数量和状态。

### 2.3 外部不确定性因素

- **定义**: 影响计划但无法预先确定的外部变量。
- **主要来源**: 发动机到场时间、缺件航材的预计到货时间、工具外借归还时间等。
- **业务要求**: 系统必须能够接收这些动态信息，并自动调整后续的计划。

## 3. 业务规则与约束

### 3.1 硬约束 (必须满足)
1.  **工作流程**: 必须严格遵守工卡子项目之间定义的前后置依赖关系。
2.  **资源独占**: 同一时刻，一个资源（如一个检验员、一个特定工位）只能用于一个任务。
3.  **资质匹配**: 执行任务的人员必须具备相应的从业资质。
4.  **物料齐全**: 任务开工前，所需的航材必须齐备。
5.  **数量限制**: 并行任务所占用的资源总数不能超过可用资源的总量。

### 3.2 软约束 (优化方向)
1.  **优才优用**: 优先将任务分配给历史绩效更好的“熟手”。
2.  **减少等待**: 优化任务顺序，最大限度减少因等待人、机、料、法、环而产生的无效工时。
3.  **工作连续性**: 鼓励将连续的、相关的任务分配给同一个人或班组，减少沟通和交接成本。

## 4. 核心功能列表

- **维修计划智能化生成**: 系统根据输入的维修需求（一个或多个发动机工卡），自动生成最优的初始执行计划。
- **维修计划智能化调整**: 当出现冲突（如行车使用冲突）或接收到外部不确定性信息时，系统自动对未开始的任务进行重排，给出调整建议。
- **资源规划智能化**: 
  - **航材**: 预测航材需求，为短期资源保障提供数据支持。
  - **人员**: 辅助进行人员排班和任务分配。
  - **工具**: 提高工具周转率和使用率。

## 5. 准备阶段（Preparation）范围与目标

- **范围**: 聚焦“准备阶段”的智能规划与排程，确保在满足所有准备门禁与SLA的前提下，使工包达到“可开工”状态。
- **准备完成定义（门禁通过）**:
  - 关键工装齐套到位（行车/吊具/支撑架等）；
  - 航材策略达标（必须齐套/可分段执行项满足开工策略）；
  - 技术资料与评估完成（工卡/手册/EB/SB/AD、重大/首做/等效措施评估）；
  - QEC货架实物交接完成；
  - 库存确认与临时工装设备台账建立完成；
  - SAP维修指令接收时效满足（≤1个工作日），准备完成后方可触发开工流程。

## 6. 术语与对象字典（准备阶段）

- **关键工装**: 行车、吊具、支撑架等影响整个工包可执行性的工装。
- **非关键工装**: 仅影响对应子项目的工装，不阻断整个工包。
- **QEC货架**: 准备阶段用于航材套件摆放与交接的物理货架，关联缺件清单与位置编码。
- **临时工装设备台账**: 对已调配到位的工装工具建立的临时性台账记录。
- **人工ETA**: 工装调配时间、航材调配/采购到货时间由人工录入，作为计划约束。

## 7. 硬约束（准备门禁）

1. 关键工装齐套门禁：若未齐套，则禁止工包开工（阻断开工）。
2. 航材齐套门禁：
   - 必须齐套类：未齐套不得开工；
   - 可分段执行类：允许先行准备/执行不受影响的子项，但需显式标注策略与范围。
3. 技术资料与评估门禁：工卡/手册/EB/SB/AD到位，重大/首做/等效措施评估完成后方可通过。
4. 行车/工位冲突规避：吊装为前置准备项，行车与工位独占且需避免冲突。
5. QEC货架交接与库存确认：实物交接、库存核对与台账建立完成为通过条件。
6. SAP指令接收SLA：≤1个工作日；准备完成后方可触发“SAP开工”。

## 8. 软约束与目标优先级（准备阶段）

优先级（建议，支持配置）：
1) 门禁与SLA合规性；
2) 最小化准备等待时长（基于人工ETA/到货ETA的动态插排）；
3) 最小化行车/工位/区域切换成本；
4) 人员与班组连续性与偏好（若纳入准备内）。

## 9. 事件与不确定性（准备阶段）

- 事件类型：工装调配ETA变更、航材到货/延期、第三方确认进度、天气（台风）影响、SAP指令状态变更。
- 处理策略：仅重排未开始的准备子项；必要时采用滚动时间窗，保持在制稳定性。

## 10. 多项目并行最优排程（准备阶段）

- **全局资源池**：行车、工位、检验/监护/监管等人力、关键工装在多工包/多发动机间共享，受独占或可累积约束。
- **跨项目优先级**：支持按SLA风险、紧急程度、关键路径暴露度进行优先级排序（可配置）。
- **冲突解决**：当资源冲突发生时，优先保护高优先级与临近SLA的项目；输出清晰的让位与调整建议。
- **批处理与合单**：对相同区域/相同工装/同类交接可进行批量准备以减少切换成本（在不违反门禁的前提下）。
- **公平性**：提供可选的公平性策略，避免长期压制低优先级项目（如最小化最大延误）。

## 11. KPI与可观测性（准备阶段）

- 准备完成总时长、关键门禁通过率、SLA达成率；
- 资源利用率（行车/工位）、冲突/重排次数；
- 等待时长分解（人/机/料/法/环）；
- 事件影响分析（前后计划差异、受影响任务清单与延误）。

## 12. 可选优化项（启用条件与说明）

- **插单策略（Preemption with Audit）**
  - 含义：当出现高优/临期SLA项目时，允许其“插队”抢占部分共享资源（行车/工位/关键工装/特定人员）。
  - 启用条件（建议）：满足以下任一条件即可触发：
    - 项目SLA剩余缓冲低于阈值（如 ≤ 12小时）；
    - 客户紧急任务标记为“紧急”；
    - 关键路径任务预计延误超过阈值（如 > 2小时）。
  - 必要输出：必须生成“让位说明与影响评估”，包含被影响项目/任务、延误时长、恢复计划与预计恢复时间。
  - 护栏参数（可配置）：
    - 单项目每日最多被抢占次数N（默认2次）；
    - 单次抢占最长时长M（默认4小时）；
    - 被抢占后恢复的优先级提升策略（例如+Δ权重或固定窗口内优先）。

- **优先级策略模板（Priority Templates）**
  - 含义：将目标权重与规则打包成模板，一键切换。
  - 默认提供三套：
    1) 保护SLA型：强保护临期与高风险项目；
    2) 均衡公平型：最小化最大延误，避免长期压制；
    3) 成本最小型：降低切换/占用/加班等成本。
  - 允许在模板基础上微调权重并灰度发布（小范围试运行，监控KPI后再全面切换）。

## 13. 默认配置建议（可调整）

- 目标优先级：门禁与SLA合规 > 等待时长最小化 > 切换成本最小化 > 连续性/偏好。
- 插单护栏默认：N=2次/天，M=4小时；必须生成影响评估与恢复计划。
- 策略模板默认：采用“均衡公平型”，月末/冲刺期切换为“保护SLA型”。
