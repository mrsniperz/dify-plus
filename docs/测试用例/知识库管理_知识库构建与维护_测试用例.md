## 覆盖范围
- 基于《概要设计说明书》4.3.1 与 6.1（维修知识库管理）
- 参考 dify-docs/en/guides/knowledge-base/* 官方说明
- 用例表格字段遵循 .cursor/rules/doc-test-cases.mdc，便于导出 Excel

## 测试用例（表格）

| 测试用例ID | 测试用例名称 | 前置条件 | 测试步骤 | 预期结果 | 实际结果 | 测试状态 |
|---|---|---|---|---|---|---|
| KB-FUNC-001 | 创建知识库（正常） | 已登录；具备创建权限 | 1. 访问/datasets 2. 点击新建 3. 填写唯一名称、权限=only_me 4. 确认创建 | 1) 创建成功并显示于列表 2) 返回详情页可见ID与权限 | 实际创建：维修手册知识库_Auto；已进入详情页。截图：docs/使用说明/images/新建知识库_1.png | 通过 |
| KB-FUNC-002 | 创建知识库（名称冲突） | 已存在名称“维修手册知识库” | 1. 新建知识库并输入已存在名称 2. 点击确认 | 提示 dataset_name_duplicate，创建被阻断 | 实际返回：HTTP 409，提示“The dataset name already exists...”。截图：docs/使用说明/images/新建知识库_2.png | 通过 |
| KB-FUNC-003 | 删除知识库（确认删除） | 已存在测试知识库，空库或允许删除 | 1. 选择目标库 2. 点击删除并确认 | 知识库从列表移除；后端返回 204/成功 | | |
| KB-FUNC-004 | 权限范围设置（partial） | 准备两个账号A/B，A为所有者 | 1. A 创建库并设置 permission=partial，添加B为成员 2. B 登录访问 | B 可见并可按角色权限操作；非成员不可见 | | |
| KB-FUNC-005 | 上传单个PDF并索引 | 存在目标库；准备PDF样本 | 1. 进入库详情 2. 上传PDF 3. 设置分段/清洗与索引方法 4. 观察状态流转 | 状态: uploaded→parsing→indexing→enabled；失败时显示错误 | PDF（SRM_52-82-11-283-001...pdf）已处理完成并显示“可用”。截图：docs/使用说明/images/上传文档_4.png、docs/使用说明/images/上传文档_5.png | 通过 |
| KB-FUNC-006 | 批量上传多格式（PDF/DOCX/MD） | 存在目标库；三种文件样本 | 1. 多选上传 2. 观察队列与进度 | 各文档分别进入解析与索引；最终 enabled | 已选 docx+md+pdf；md 文件上传报 502（Bad Gateway）后删除；docx 与 pdf 成功进入处理流程。截图：docs/使用说明/images/上传文档_2.png、_4.png | 通过（含异常记录） |
| KB-FUNC-007 | 不支持的文件类型 | 准备超出白名单的类型 | 1. 尝试上传不支持类型 | 提示 unsupported_file_type；拒绝处理 | | |
| KB-FUNC-008 | 大文件超限 | 准备超出大小阈值的文件 | 1. 上传大文件 | 提示 file_too_large；入队被拒绝 | | |
| KB-FUNC-009 | 文档更新触发重建索引 | 已有已启用文档 | 1. 对文档执行 update_by_file 2. 观察重建流程 | 触发重新解析/索引，完成后保持 enabled | | |
| KB-FUNC-010 | 文档禁用/启用 | 已有 enabled 文档 | 1. 禁用文档 2. 再次启用 | 禁用后不参与检索；启用后恢复参与 | | |
| KB-FUNC-011 | 文档归档 | 已有 enabled 文档 | 1. 归档文档 2. 尝试编辑 | 归档后只读不可编辑；编辑被拒绝 | | |
| KB-FUNC-012 | 分段新增/编辑/删除 | 已有文档与分段权限 | 1. 新增分段 2. 编辑分段内容或关键词 3. 删除分段 | 新增成功；编辑生效且留痕；删除成功 | | |
| KB-FUNC-013 | 子分段维护 | 已有父分段 | 1. 新增子分段 2. 查询 3. 更新 4. 删除 | 子分段CRUD成功，受权限与审计约束 | | |
| KB-FUNC-014 | 元数据字段新增/更新/删除 | 具备字段管理权限 | 1. 新增字段(name,type) 2. 更新字段 3. 删除字段 | 字段库变更生效；删除需二次确认 | | |
| KB-FUNC-015 | 批量赋值文档元数据 | 已有多文档 | 1. 选中文档 2. 批量赋值字段 | 文档 metadata 更新可见；可按字段筛选 | | |
| KB-FUNC-016 | 召回测试台参数调试（TopK/Score/Filters） | 文档已索引完成 | 1. 输入查询 2. 调整TopK/Score与过滤 3. 对比结果 | 召回列表与引用随参数变化；可保存策略 | | |
| KB-FUNC-017 | 请求频率限制 | 打开两个会话或脚本 | 1. 在1分钟内高频创建/上传/检索 2. 观察反馈 | 返回限流提示并暂缓；记录告警 | | |
| KB-FUNC-018 | 外部知识库联合检索 | 已配置外部连接 | 1. 执行查询 2. 观察合并与重排 | 外部结果标准化并重排；失败自动降级内部 | | |
| KB-FUNC-019 | 应用对话检索与引用 | 有对话型应用绑定 | 1. 通过应用发送 query+inputs 2. 查看引用 | 返回答案与 retriever_resources 引用与定位 | | |
| KB-SEC-001 | 权限矩阵校验 | 拥有不同角色账号 | 按角色分别尝试创建/上传/编辑/禁用/归档/字段管理 | 行为与矩阵一致；越权操作被拒绝并提示 | | |
| KB-SEC-002 | 审计留痕 | 审计启用 | 进行字段变更、分段编辑、索引重建、策略发布 | 审计记录包含人/时/对象/差异/原因 | | |
| KB-ERR-001 | 文档处理中不可编辑 | 有 indexing 状态文档 | 尝试编辑文档或分段 | 提示 document_indexing，拒绝编辑 | | |
| KB-ERR-002 | 知识库未初始化 | 模拟未完成初始化状态 | 执行检索/上传 | 提示 dataset_not_initialized | | |
| KB-COMP-001 | 多浏览器兼容 | Chrome/Edge/Safari | 分别执行核心路径 | UI 功能一致，关键流程可用 | | |

注: 实际执行时，将“实际结果/测试状态”回填，并附上截图路径（docs/使用说明/images/...）。
